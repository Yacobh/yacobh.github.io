{"version":3,"sources":["universo/components/guestbook.cljs"],"mappings":"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","names":["universo.components.guestbook/validate-form","form-data","map__11898","cljs.core/--destructure-map","cljs.core.get","name","message","errors","G__11902","clojure.string/blank?","cljs.core.assoc","and__5000__auto__","cljs.core/not","cljs.core/re-matches","universo.components.guestbook/guestbook-form","on-submit","loading?","reagent.core.atom","success","cljs.core/deref","p1__11909#","p1__11910#","p1__11911#","p1__11913#","cljs.core/reset!","e","validation-errors","cljs.core/empty?","G__11940","G__11941","cljs.core.swap_BANG_","cljs.core/assoc","universo.components.guestbook/guestbook-entry","entry","js/Date","universo.components.guestbook/guestbook-list","entries","iter__5480__auto__","s__11957","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5478__auto__","size__5479__auto__","cljs.core/count","b__11959","cljs.core/chunk-buffer","i__11958","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__11956","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","universo.components.guestbook/guestbook-component","loading-entries?","loading-submit?","reagent.core.create_class","universo.db.supabase/get-guestbook-entries","p1__11967#","p1__11968#","js/console.error","on-success","universo.db.supabase/add-guestbook-entry","new-entry","p1__11969#","cljs.core/vec","p1__11970#","cljs.core/chunk-first"],"sourcesContent":["(ns universo.components.guestbook\n  (:require [reagent.core :as r]\n            [clojure.string :as str]\n            [universo.db.supabase :as supabase]))\n\n(defn validate-form [form-data]\n  (let [{:keys [name message]} form-data\n        errors {}]\n    (cond-> errors\n      (str/blank? name) (assoc :name \"El nombre es requerido\")\n      (str/blank? message) (assoc :message \"El mensaje es requerido\")\n      (and (:email form-data)\n           (not (re-matches #\".+@.+\\..+\" (:email form-data))))\n      (assoc :email \"Email inv\u00e1lido\"))))\n\n(defn guestbook-form [on-submit loading?]\n  (let [form-data (r/atom {:name \"\" :email \"\" :phone \"\" :message \"\"})\n        errors (r/atom {})\n        success (r/atom false)]\n\n    (fn []\n      [:div.guestbook-form.bg-white.rounded-lg.shadow-lg.p-6.mb-8\n       [:div.text-center.mb-6\n        [:h2.text-2xl.font-bold.text-gray-800.mb-2\n         \"\u00a1Hola! Soy Jacobo C\u00f3rdova\"]\n        [:p.text-gray-600\n         \"Me encantar\u00eda conocerte. \u00bfQuieres escribir tu nombre en mi libro de visitas?\"]]\n\n       (if @success\n         [:div.text-center.py-8\n          [:div.text-green-600.text-6xl.mb-4 \"\u2713\"]\n          [:h3.text-xl.font-semibold.text-gray-800.mb-2 \"\u00a1Gracias por firmar!\"]\n          [:p.text-gray-600 \"Tu mensaje ha sido agregado al libro de visitas.\"]\n          [:button.mt-4.px-4.py-2.bg-blue-500.text-white.rounded.hover:bg-blue-600\n           {:on-click #(do (reset! success false)\n                           (reset! form-data {:name \"\" :email \"\" :phone \"\" :message \"\"}))}\n           \"Agregar otro mensaje\"]]\n\n         [:form {:on-submit (fn [e]\n                              (.preventDefault e)\n                              (let [validation-errors (validate-form @form-data)]\n                                (if (empty? validation-errors)\n                                  (do\n                                    (reset! errors {})\n                                    (on-submit @form-data\n                                               #(reset! success true)))\n                                  (reset! errors validation-errors))))}\n\n          [:div.grid.grid-cols-1.md:grid-cols-2.gap-4.mb-4\n           [:div\n            [:label.block.text-sm.font-medium.text-gray-700.mb-1\n             \"Nombre *\"]\n            [:input.w-full.px-3.py-2.border.border-gray-300.rounded-md.focus:outline-none.focus:ring-2.focus:ring-blue-500\n             {:type \"text\"\n              :value (:name @form-data)\n              :on-change #(swap! form-data assoc :name (-> % .-target .-value))\n              :class (when (:name @errors) \"border-red-500\")}]\n            (when (:name @errors)\n              [:p.text-red-500.text-sm.mt-1 (:name @errors)])]\n\n           [:div\n            [:label.block.text-sm.font-medium.text-gray-700.mb-1\n             \"Email (opcional)\"]\n            [:input.w-full.px-3.py-2.border.border-gray-300.rounded-md.focus:outline-none.focus:ring-2.focus:ring-blue-500\n             {:type \"email\"\n              :value (:email @form-data)\n              :on-change #(swap! form-data assoc :email (-> % .-target .-value))\n              :class (when (:email @errors) \"border-red-500\")}]\n            (when (:email @errors)\n              [:p.text-red-500.text-sm.mt-1 (:email @errors)])]]\n\n          [:div.mb-4\n           [:label.block.text-sm.font-medium.text-gray-700.mb-1\n            \"Tel\u00e9fono (opcional)\"]\n           [:input.w-full.px-3.py-2.border.border-gray-300.rounded-md.focus:outline-none.focus:ring-2.focus:ring-blue-500\n            {:type \"tel\"\n             :value (:phone @form-data)\n             :on-change #(swap! form-data assoc :phone (-> % .-target .-value))}]]\n\n          [:div.mb-6\n           [:label.block.text-sm.font-medium.text-gray-700.mb-1\n            \"Mensaje *\"]\n           [:textarea.w-full.px-3.py-2.border.border-gray-300.rounded-md.focus:outline-none.focus:ring-2.focus:ring-blue-500.h-24\n            {:value (:message @form-data)\n             :on-change #(swap! form-data assoc :message (-> % .-target .-value))\n             :placeholder \"Escribe aqu\u00ed tu mensaje...\"\n             :class (when (:message @errors) \"border-red-500\")}]\n           (when (:message @errors)\n             [:p.text-red-500.text-sm.mt-1 (:message @errors)])]\n\n          [:div.text-center\n           [:button.px-6.py-3.bg-blue-600.text-white.font-semibold.rounded-lg.hover:bg-blue-700.focus:outline-none.focus:ring-2.focus:ring-blue-500.disabled:opacity-50.disabled:cursor-not-allowed\n            {:type \"submit\"\n             :disabled loading?}\n            (if loading?\n              [:span.flex.items-center.justify-center\n               [:svg.animate-spin.h-4.w-4.mr-2.text-white\n                {:viewBox \"0 0 24 24\"}\n                [:circle.opacity-25 {:cx \"12\" :cy \"12\" :r \"10\" :stroke \"currentColor\" :stroke-width \"4\"}]\n                [:path.opacity-75 {:fill \"currentColor\" :d \"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"}]]\n               \"Enviando...\"]\n              \"\u270d\ufe0f Firmar el libro de visitas\")]]])])))\n\n(defn guestbook-entry [entry]\n  [:div.bg-gray-50.rounded-lg.p-4.mb-4.border-l-4.border-blue-500\n   [:div.flex.justify-between.items-start.mb-2\n    [:h4.font-semibold.text-gray-800 (:name entry)]\n    [:span.text-sm.text-gray-500\n     (.toLocaleDateString (js/Date. (:created_at entry)) \"es-ES\")]]\n   [:p.text-gray-700.leading-relaxed (:message entry)]\n   #_(when (and (:email entry) (not (str/blank? (:email entry))))\n     [:p.text-sm.text-gray-500.mt-2\n      [:span \"\ud83d\udce7 \" (:email entry)]])])\n\n(defn guestbook-list [entries loading?]\n  [:div.guestbook-list\n   [:h3.text-xl.font-bold.text-gray-800.mb-4.text-center\n    \"Mensajes del libro de visitas\"]\n\n   (if loading?\n     [:div.text-center.py-8\n      [:div.inline-block.animate-spin.rounded-full.h-8.w-8.border-b-2.border-blue-600]]\n\n     (if (empty? entries)\n       [:div.text-center.py-8.text-gray-500\n        [:p \"S\u00e9 el primero en firmar el libro de visitas\"]]\n\n       [:div\n        (for [entry entries]\n          ^{:key (:id entry)}\n          [guestbook-entry entry])]))])\n\n(defn guestbook-component []\n  (let [entries (r/atom [])\n        loading-entries? (r/atom true)\n        loading-submit? (r/atom false)]\n\n    ;; Cargar entradas al montar el componente\n    (r/create-class\n     {:component-did-mount\n      (fn []\n        (-> (supabase/get-guestbook-entries)\n            (.then #(do (reset! entries %)\n                        (reset! loading-entries? false)))\n            (.catch #(do (js/console.error \"Error loading guestbook:\" %)\n                         (reset! loading-entries? false)))))\n\n      :reagent-render\n      (fn []\n        [:div.max-w-4xl.mx-auto.px-4.py-8\n         [guestbook-form\n          (fn [form-data on-success]\n            (reset! loading-submit? true)\n            (-> (supabase/add-guestbook-entry form-data)\n                (.then (fn [new-entry]\n                         (swap! entries #(vec (cons new-entry %)))\n                         (reset! loading-submit? false)\n                         (on-success)))\n                (.catch #(do (js/console.error \"Error submitting:\" %)\n                             (reset! loading-submit? false)))))\n          @loading-submit?]\n\n         [guestbook-list @entries @loading-entries?]])})))\n"]}