{
"version":3,
"file":"module$node_modules$$supabase$realtime_js$dist$module$RealtimePresence.js",
"lineCount":129,
"mappings":"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",
"sources":["node_modules/@supabase/realtime-js/dist/module/RealtimePresence.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$supabase$realtime_js$dist$module$RealtimePresence\"] = function(global,require,module,exports) {\nObject.defineProperties(exports, {__esModule:{enumerable:true, value:true}, REALTIME_PRESENCE_LISTEN_EVENTS:{enumerable:true, get:function() {\n  return REALTIME_PRESENCE_LISTEN_EVENTS;\n}}, default:{enumerable:true, get:function() {\n  return RealtimePresence;\n}}});\nvar REALTIME_PRESENCE_LISTEN_EVENTS;\n(function(REALTIME_PRESENCE_LISTEN_EVENTS) {\n  REALTIME_PRESENCE_LISTEN_EVENTS[\"SYNC\"] = \"sync\";\n  REALTIME_PRESENCE_LISTEN_EVENTS[\"JOIN\"] = \"join\";\n  REALTIME_PRESENCE_LISTEN_EVENTS[\"LEAVE\"] = \"leave\";\n})(REALTIME_PRESENCE_LISTEN_EVENTS || (REALTIME_PRESENCE_LISTEN_EVENTS = {}));\nclass RealtimePresence {\n  constructor(channel, opts) {\n    this.channel = channel;\n    this.state = {};\n    this.pendingDiffs = [];\n    this.joinRef = null;\n    this.caller = {onJoin:() => {\n    }, onLeave:() => {\n    }, onSync:() => {\n    },};\n    const events = (opts === null || opts === void 0 ? void 0 : opts.events) || {state:\"presence_state\", diff:\"presence_diff\",};\n    this.channel._on(events.state, {}, newState => {\n      const {onJoin, onLeave, onSync} = this.caller;\n      this.joinRef = this.channel._joinRef();\n      this.state = RealtimePresence.syncState(this.state, newState, onJoin, onLeave);\n      this.pendingDiffs.forEach(diff => {\n        this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\n      });\n      this.pendingDiffs = [];\n      onSync();\n    });\n    this.channel._on(events.diff, {}, diff => {\n      const {onJoin, onLeave, onSync} = this.caller;\n      if (this.inPendingSyncState()) {\n        this.pendingDiffs.push(diff);\n      } else {\n        this.state = RealtimePresence.syncDiff(this.state, diff, onJoin, onLeave);\n        onSync();\n      }\n    });\n    this.onJoin((key, currentPresences, newPresences) => {\n      this.channel._trigger(\"presence\", {event:\"join\", key, currentPresences, newPresences,});\n    });\n    this.onLeave((key, currentPresences, leftPresences) => {\n      this.channel._trigger(\"presence\", {event:\"leave\", key, currentPresences, leftPresences,});\n    });\n    this.onSync(() => {\n      this.channel._trigger(\"presence\", {event:\"sync\"});\n    });\n  }\n  static syncState(currentState, newState, onJoin, onLeave) {\n    const state = this.cloneDeep(currentState);\n    const transformedState = this.transformState(newState);\n    const joins = {};\n    const leaves = {};\n    this.map(state, (key, presences) => {\n      if (!transformedState[key]) {\n        leaves[key] = presences;\n      }\n    });\n    this.map(transformedState, (key, newPresences) => {\n      const currentPresences = state[key];\n      if (currentPresences) {\n        const newPresenceRefs = newPresences.map(m => m.presence_ref);\n        const curPresenceRefs = currentPresences.map(m => m.presence_ref);\n        const joinedPresences = newPresences.filter(m => curPresenceRefs.indexOf(m.presence_ref) < 0);\n        const leftPresences = currentPresences.filter(m => newPresenceRefs.indexOf(m.presence_ref) < 0);\n        if (joinedPresences.length > 0) {\n          joins[key] = joinedPresences;\n        }\n        if (leftPresences.length > 0) {\n          leaves[key] = leftPresences;\n        }\n      } else {\n        joins[key] = newPresences;\n      }\n    });\n    return this.syncDiff(state, {joins, leaves}, onJoin, onLeave);\n  }\n  static syncDiff(state, diff, onJoin, onLeave) {\n    const {joins, leaves} = {joins:this.transformState(diff.joins), leaves:this.transformState(diff.leaves),};\n    if (!onJoin) {\n      onJoin = () => {\n      };\n    }\n    if (!onLeave) {\n      onLeave = () => {\n      };\n    }\n    this.map(joins, (key, newPresences) => {\n      var _a;\n      const currentPresences = (_a = state[key]) !== null && _a !== void 0 ? _a : [];\n      state[key] = this.cloneDeep(newPresences);\n      if (currentPresences.length > 0) {\n        const joinedPresenceRefs = state[key].map(m => m.presence_ref);\n        const curPresences = currentPresences.filter(m => joinedPresenceRefs.indexOf(m.presence_ref) < 0);\n        state[key].unshift(...curPresences);\n      }\n      onJoin(key, currentPresences, newPresences);\n    });\n    this.map(leaves, (key, leftPresences) => {\n      let currentPresences = state[key];\n      if (!currentPresences) {\n        return;\n      }\n      const presenceRefsToRemove = leftPresences.map(m => m.presence_ref);\n      currentPresences = currentPresences.filter(m => presenceRefsToRemove.indexOf(m.presence_ref) < 0);\n      state[key] = currentPresences;\n      onLeave(key, currentPresences, leftPresences);\n      if (currentPresences.length === 0) {\n        delete state[key];\n      }\n    });\n    return state;\n  }\n  static map(obj, func) {\n    return Object.getOwnPropertyNames(obj).map(key => func(key, obj[key]));\n  }\n  static transformState(state) {\n    state = this.cloneDeep(state);\n    return Object.getOwnPropertyNames(state).reduce((newState, key) => {\n      const presences = state[key];\n      if (\"metas\" in presences) {\n        newState[key] = presences.metas.map(presence => {\n          presence[\"presence_ref\"] = presence[\"phx_ref\"];\n          delete presence[\"phx_ref\"];\n          delete presence[\"phx_ref_prev\"];\n          return presence;\n        });\n      } else {\n        newState[key] = presences;\n      }\n      return newState;\n    }, {});\n  }\n  static cloneDeep(obj) {\n    return JSON.parse(JSON.stringify(obj));\n  }\n  onJoin(callback) {\n    this.caller.onJoin = callback;\n  }\n  onLeave(callback) {\n    this.caller.onLeave = callback;\n  }\n  onSync(callback) {\n    this.caller.onSync = callback;\n  }\n  inPendingSyncState() {\n    return !this.joinRef || this.joinRef !== this.channel._joinRef();\n  }\n}\n\n};"],
"names":["shadow$provide","global","require","module","exports","Object","defineProperties","__esModule","enumerable","value","REALTIME_PRESENCE_LISTEN_EVENTS","get","default","RealtimePresence","constructor","channel","opts","state","pendingDiffs","joinRef","caller","onJoin","onLeave","onSync","events","diff","_on","newState","_joinRef","syncState","forEach","syncDiff","inPendingSyncState","push","key","currentPresences","newPresences","_trigger","event","leftPresences","currentState","cloneDeep","transformedState","transformState","joins","leaves","map","presences","newPresenceRefs","m","presence_ref","curPresenceRefs","joinedPresences","filter","indexOf","length","_a","joinedPresenceRefs","curPresences","unshift","presenceRefsToRemove","obj","func","getOwnPropertyNames","reduce","metas","presence","JSON","parse","stringify","callback"]
}
